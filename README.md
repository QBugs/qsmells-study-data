# The Smelly Eight: An Empirical Study on the Prevalence of Code Smells in Quantum Computing

This repository contains all scripts and data required to [repeat and replicate](https://www.acm.org/publications/policies/artifact-review-badging) the study 'The Smelly Eight: An Empirical Study on the Prevalence of Code Smells in Quantum Computing'.

Each top-level directory in this repository provides the required scripts and data to perform a specific analysis described in the paper.

| Directory                        | Description |
|:---------------------------------|:------------|
| [`experiments/`](experiments/)   | Study the prevalence of quantum-specific smells on quantum programs |
| [`samples/`](samples/)           | Examples used in Section III |
| [`subjects/`](subjects/)         | The subjects (i.e., quantum programs) used in the empirical evaluation |
| [`survey/`](survey/)             | Questions asked and answers provided by participants of the survey |
| [`tools/`](tools/)               | Local directory that keeps all required tools and environments to run those tools |
| [`tools/qsmell/`](tools/qsmell/) | QSmell's source code |
| [`utils/`](utils/)               | Utility scripts that are used by more than one experiment / analysis |

Each top-level directory has the following structure:
- `data/`: Data files used as inputs by the scripts and automatically generated by the scripts of each analysis to facilitate faster processing.
  * `data/FILE-SPECS.md`: Defines the format of all CSV files in each `data` directory.
- `scripts/`: Scripts for performing the corresponding analysis.
- `statistics/`: R scripts that process the data and produce numbers, tables, and figures for the paper.

## Instructions for reproducing the analyses and results in the paper

The following sections provides step-by-step instructions to reproduce the analyses, tables, and figures reported in the paper.
Note: the following bash commands have been tested and used on a Unix-based machine and therefore might not work on other operating systems, e.g., Windows.

### Requirements

The subsequent analyses require the following tools to be installed and available on your machine:
- [GIT](https://git-scm.com) to clone any required repository, tool, etc.
- [GNU Parallel](https://www.gnu.org/software/parallel) to parallelize experiments.
- [Perl](https://www.perl.org)
- [R](https://www.r-project.org)

### Setup

In the top-level directory [`tools/`](tools/), run the following command to automatically setup all required tools (e.g., get subjects source code, configure a Python custom environment to run Python code, compile QSmell, install all required R packages, etc).

```bash
bash get-tools.sh # (~10 minutes)
```

Note: the execution of this command is only required once.


### Run [`QSmell`](tools/qsmell/) on a quantum program and specific code smell

In the directory [`experiments/scripts/`](experiments/scripts/), run the following command as

```bash
bash run-qsmell.sh \
  --input_file_path <path, e.g., ../../subjects/data/generated/quantum-circuit-as-matrix/grover.csv or ../../tools/qiskit-terra/qiskit/algorithms/amplitude_amplifiers/grover.py> \
  --smell_metric <str, name of the smell metric to compute: CG, ROC, NC, LC, IM, IdQ, IQ, AQ, LPQ> \
  --output_file_path <path>
```

for example, to invoke [`QSmell`](tools/qsmell/) with the quantum-specific smell `IdQ` on the `shor` quantum program, run

```bash
bash run-qsmell.sh \
  --input_file_path ../../subjects/data/generated/quantum-circuit-as-matrix/shor.csv \
  --smell_metric "IdQ" \
  --output_file_path ../data/generated/qsmell-metrics/IdQ/shor/data.csv # (< 1 minute)
```

Note: Description of the `data.csv` file generated by the [`experiments/scripts/run-qsmell.sh`](experiments/scripts/run-qsmell.sh) can be found in [`experiments/data/FILE-SPECS.md`](experiments/data/FILE-SPECS.md).

To run, all smells on all programs one might use the [`experiments/scripts/run-qsmell-on-all-subjects-all-metrics.sh`](experiments/scripts/run-qsmell-on-all-subjects-all-metrics.sh) which basically invokes the [`experiments/scripts/run-qsmell.sh`](experiments/scripts/run-qsmell.sh).

#### Analyze smells' data

In the directory [`experiments/statistics/`](experiments/statistics/), run the following command to create Table V in the paper

```bash
Rscript smell-metrics-as-table.R \
  ../data/generated/qsmell-metrics/data.csv \
  qsmell-metrics.tex
```
